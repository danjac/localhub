{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "activities/base.html" %}

{% load i18n %}
{% load rules %}
{% load users_tags %}

{% block subtitle %} | {% trans "Home" %}{% endblock %}
{% block content %}
{% has_perm 'activities.create_activity' user community as can_create_activity %}
{% if can_create_activity %}
<div class="mb-1">
    <div class="input-group">
        <span class="input-group-addon">
            {% avatar user %}
        </span>
        <input type="text"
               class="form-input conversation-input"
               data-controller="linkify"
               data-action="focus->linkify#go"
               data-linkify-url="{% url 'posts:create' %}"
               placeholder="{% trans "What's on your mind?" %}">
    </div>
</div>
{% elif user.is_authenticated %}
<p class="toast text-center my-1">
    {% if join_request_sent %}
    {% trans "Your application to join this community is pending approval from the site admins." %}
    {% else %}
    {% url 'join_requests:create' as join_request_url %}
    {% blocktrans %}You do not have permission to post to this site. You can send a request to join this community <a href="{{ join_request_url }}">here</a>.{% endblocktrans %}
    {% endif %}
</p>
{% else %}
<p class="toast text-center my-1">
    {% url 'account_login' as login_url %}
    {% blocktrans %}Please <a href="{{ login_url }}">sign in</a> to post content to this site.{% endblocktrans %}
</p>
{% endif %}

{% if request.do_not_track and not user.show_embedded_content %}
<p class="toast text-center my-1 d-hide"
   data-controller="cookie-notice"
   data-cookie-notice-name="embedded-content"
   data-cookie-notice-domain="{{ community.domain }}">
    <button class="btn btn-clear float-right" data-action="cookie-notice#accept"></button>
    {% blocktrans %}
    Embedded content has been removed because your browser has enabled Do Not Track (DNT).
    {% endblocktrans %}
    {% if user.is_authenticated %}
    {% url "user_update" as user_update_url %}
    {% blocktrans %}
    You can view embedded content by checking the <b>Show embedded content</b> option in your
    <a href="{{ user_update_url }}">user settings</a>.
    {% endblocktrans %}
    {% endif %}
</p>
{% endif %}

{% if can_create_activity %}
<div class="actions">
    <a href="{% url 'events:create' %}">{% trans "Submit Event" %}</a>
    <a href="{% url 'photos:create' %}">{% trans "Submit Photo" %}</a>
    <a href="{% url 'activities:timeline' %}">{% trans "Timeline" %}</a>
    <a href="{% url 'help_pages:page' 'content' %}#posts-events-and-photos">{% trans "Help" %}</a>
</div>
<div class="divider"></div>
{% endif %}


{% include "activities/includes/activity_list.html" %}
{% endblock content %}
