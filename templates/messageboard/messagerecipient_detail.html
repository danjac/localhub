{# Copyright (c) 2019 by Dan Jacob #}
{# SPDX-License-Identifier: AGPL-3.0-or-later #}

{% extends "messageboard/base.html" %}

{% load i18n %}
{% load account %}

{% block messageboard_header %}{% endblock %}

{% block messageboard_content %}
{% with message=object.message %}
{% user_display message.sender as sender %}
<ul class="breadcrumb">
    <li class="breadcrumb-item">
        <a href="{% url 'messageboard:message_recipient_list' %}">{% trans "Inbox" %}</a>
    </li>
    <li class="breadcrumb-item">
        <a href="{% url 'messageboard:sender_message_recipient_list' message.sender.username %}">{{ sender }}</a>
    </li>
    <li class="breadcrumb-item">
        <a href="#">{{ message.subject|truncatechars:60 }}</a>
    </li>
</ul>

<div class="float-right">
    <a href="{% url 'messageboard:message_create_reply' message.id %}" class="btn btn-sm">
        {% trans "Reply" %}
    </a>
    <a href="{% url 'messageboard:message_recipient_delete' object.id %}"
       class="btn btn-sm"
       data-controller="ajax confirm"
       data-action="confirm#check ajax#delete"
       data-confirm-header="{% trans 'Delete' %}"
       data-confirm-body="{% trans 'Are you sure you want to delete this message?' %}"
       >
       {% trans "Delete" %}
    </a>
</div>
<div class="clearfix"></div>

<dl>
    <dt>{% trans "Subject" %}</dt>
    <dd>{{ message.subject }}</dd>
    {% with parent=message.parent %}
    {% if parent.sender == user %}
    <dt>{% trans "Reply to" %}</dt>
    <dd><a href="{{ parent.get_absolute_url }}">{{ parent.subject }}</a></dd>
    {% endif %}
    {% endwith %}
    <dt>{% trans "From" %}</dt>
    <dd>
    {% include "users/includes/chip.html" with profile=message.sender %}
    <a href="{% url 'messageboard:sender_message_recipient_list' message.sender.username %}">{% trans "See all from this user" %}</a>
    </dd>
    <dt>{% trans "Received" %}</dt>
    <dd>{{ message.created|date:"DATETIME_FORMAT" }}</dd>
</dl>

<hr />

<div class="markdown-content">
    {{ message.message.markdown }}
</div>

{% endwith %}
{% endblock messageboard_content %}

